
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Register - Learning Platform</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loginglass.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-theme">
    <!-- Animated Background Elements -->
    <div class="animated-bg">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="particle-container" id="particles"></div>
    </div>
    
    <!-- Professional Navigation - Match Login -->
    <nav class="navbar-glass">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{{ url_for('index') }}" class="nav-link-btn">
                    <i class="fas fa-home"></i> Home
                </a>
            </div>
            <div class="nav-center">
                <a href="{{ url_for('index') }}" class="logo-main">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Learning Platform</span>
                </a>
            </div>
            <div class="nav-right">
                <a href="{{ url_for('login') }}" class="nav-link-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </a>
            </div>
        </div>
    </nav>

    <div class="container">

        <main class="glass main-content" style="max-width: 600px;">
            <h1>üöÄ Executive Registration</h1>
            
            <div id="alert-container"></div>

            <!-- Google Connect Section -->
            <div id="google-connect-section" style="animation: fadeInUp 0.6s ease-out 0.2s both; position: relative; z-index: 1;">
                <button type="button" class="btn btn-primary btn-google" id="google-connect-btn" style="width: 100%; margin-bottom: 20px;" onclick="connectGoogle()">
                    üîó Connect with Google
                </button>
                
                <div id="google-connected-status" style="display: none; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); padding: 20px; border-radius: 15px; box-shadow: 0 8px 25px rgba(86, 171, 47, 0.3); text-align: center;">
                        <span style="font-size: 28px; margin-right: 10px;">‚úÖ</span>
                        <span style="color: #fff; font-weight: 700; font-size: 18px;">Google Connected</span>
                        <div style="margin-top: 10px;">
                            <span id="connected-email" style="color: #fff; font-size: 14px; opacity: 0.95;"></span>
                        </div>
                    </div>
                </div>
                
                <div id="or-divider" class="divider">OR</div>
            </div>

            <!-- Progress Steps -->
            <div class="progress-steps" style="margin-bottom: 30px;">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Personal Info</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Organization</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Security</div>
                </div>
            </div>

            <form id="registerForm" enctype="multipart/form-data">
                <!-- Step 1: Personal Information -->
                <div class="form-step active" data-step="1">
                    <div class="form-group">
                        <label for="full_name">
                            <span class="label-icon">üë§</span> Full Name
                        </label>
                        <input type="text" 
                               id="full_name" 
                               name="full_name" 
                               required 
                               minlength="9" 
                               placeholder="Enter your full name (min 9 characters)" 
                               value="{{ google_name or '' }}">
                        <small id="name-counter" style="color: rgba(255,255,255,0.7);">0/9 characters</small>
                    </div>

                    <div class="form-group">
                        <label for="email">
                            <span class="label-icon">üìß</span> Email Address
                        </label>
                        <input type="email" 
                               id="email" 
                               name="email" 
                               {% if google_email %}value="{{ google_email }}" readonly{% else %}required placeholder="your.email@example.com"{% endif %}>
                        <small id="email-validation" style="display: none;"></small>
                    </div>

                    <button type="button" class="btn btn-primary" style="width: 100%;" onclick="nextStep(2)">
                        Next Step ‚Üí
                    </button>
                </div>

                <!-- Step 2: Organization Details -->
                <div class="form-step" data-step="2">
                    <div class="form-group">
                        <label for="organization_name">
                            <span class="label-icon">üè¢</span> Organization Name
                        </label>
                        <input type="text" 
                               id="organization_name" 
                               name="organization_name" 
                               required 
                               placeholder="Your organization name">
                    </div>

                    <div class="form-group">
                        <label for="organization_logo">
                            <span class="label-icon">üñºÔ∏è</span> Organization Logo
                        </label>
                        <div class="file-upload-wrapper">
                            <input type="file" 
                                   id="organization_logo" 
                                   name="organization_logo" 
                                   accept="image/*"
                                   onchange="previewLogo(event)">
                            <div id="logo-preview" style="margin-top: 15px; text-align: center; display: none;">
                                <img id="logo-preview-img" style="max-width: 150px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.3);">
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button type="button" class="btn" style="flex: 1; background: rgba(255,255,255,0.2);" onclick="previousStep(1)">
                            ‚Üê Back
                        </button>
                        <button type="button" class="btn btn-primary" style="flex: 1;" onclick="nextStep(3)">
                            Next Step ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 3: Security -->
                <div class="form-step" data-step="3">
                    <div class="form-group">
                        <label for="password">
                            <span class="label-icon">üîí</span> Password
                        </label>
                        <div class="password-toggle">
                            <input type="password" 
                                   id="password" 
                                   name="password" 
                                   {% if not google_email %}required placeholder="Create a strong password"{% else %}placeholder="Optional (Google signup will auto-generate)"{% endif %}>
                            <button type="button" class="toggle-btn" onclick="togglePassword('password')">
                                <span class="eye-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                        <div class="password-strength">
                            <div id="strength-bar" class="password-strength-bar"></div>
                        </div>
                        <small id="strength-text" style="margin-top: 5px; display: block; color: rgba(255,255,255,0.8);"></small>
                        
                        <div id="password-requirements" style="margin-top: 10px; font-size: 12px;">
                            <div class="requirement" id="req-length">
                                <span class="req-icon">‚≠ï</span> At least 8 characters
                            </div>
                            <div class="requirement" id="req-case">
                                <span class="req-icon">‚≠ï</span> Upper & lowercase letters
                            </div>
                            <div class="requirement" id="req-number">
                                <span class="req-icon">‚≠ï</span> Contains a number
                            </div>
                            <div class="requirement" id="req-special">
                                <span class="req-icon">‚≠ï</span> Special character
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirm_password">
                            <span class="label-icon">üîê</span> Confirm Password
                        </label>
                        <div class="password-toggle">
                            <input type="password" 
                                   id="confirm_password" 
                                   name="confirm_password" 
                                   {% if not google_email %}required placeholder="Confirm your password"{% else %}placeholder="Optional"{% endif %}>
                            <button type="button" class="toggle-btn" onclick="togglePassword('confirm_password')">
                                <span class="eye-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                        <small id="password-match" style="margin-top: 5px; display: block;"></small>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button type="button" class="btn" style="flex: 1; background: rgba(255,255,255,0.2);" onclick="previousStep(2)">
                            ‚Üê Back
                        </button>
                        <button type="submit" class="btn btn-primary" style="flex: 2;" id="submitBtn">
                            <span class="btn-text">üéâ Create Account</span>
                            <span class="btn-loading" style="display: none;">
                                <span class="loading"></span> Creating...
                            </span>
                        </button>
                    </div>
                </div>
            </form>

            <p style="text-align: center; margin-top: 30px; color: rgba(255, 255, 255, 0.9);">
                Already have an account? 
                <a href="{{ url_for('login') }}" style="color: #fff; text-decoration: underline; font-weight: 600;">
                    Login here
                </a>
            </p>
        </main>
    </div>

    <style>
        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .step {
            flex: 1;
            text-align: center;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .step.active {
            opacity: 1;
        }

        .step.completed {
            opacity: 1;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #fff;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            animation: pulse-ring 2s infinite;
        }

        .step.completed .step-number {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            border-color: #a8e063;
        }

        .step.completed .step-number::after {
            content: '‚úì';
            position: absolute;
            font-size: 24px;
        }

        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(102, 126, 234, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
            }
        }

        .step-label {
            font-size: 12px;
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .step-line {
            flex: 1;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 -10px;
            margin-bottom: 35px;
            position: relative;
            overflow: hidden;
        }

        .step-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: left 0.5s ease;
        }

        .step.completed + .step-line::after {
            left: 0;
        }

        .form-step {
            display: none;
            animation: fadeInScale 0.5s ease-out;
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .requirement {
            color: rgba(255, 255, 255, 0.6);
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        .requirement.met {
            color: #a8e063;
        }

        .requirement .req-icon {
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        .requirement.met .req-icon {
            transform: scale(1.2) rotate(360deg);
        }

        .requirement.met .req-icon::before {
            content: '‚úÖ';
        }

        .file-upload-wrapper {
            position: relative;
        }

        #logo-preview {
            animation: zoomIn 0.5s ease-out;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes slideOutUp {
            to {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
    </style>

    <script>
        let currentStep = 1;

        function nextStep(step) {
            if (validateCurrentStep()) {
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
                document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
                currentStep = step;
                document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
                document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                createConfetti();
            }
        }

        function previousStep(step) {
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            currentStep = step;
            document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
            document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateCurrentStep() {
            const currentStepEl = document.querySelector(`.form-step[data-step="${currentStep}"]`);
            const inputs = currentStepEl.querySelectorAll('input[required]');
            
            for (let input of inputs) {
                if (!input.value || (input.minLength && input.value.length < input.minLength)) {
                    input.focus();
                    input.style.animation = 'shake 0.5s';
                    setTimeout(() => input.style.animation = '', 500);
                    showAlert('‚ùå Please fill in all required fields correctly', 'error');
                    return false;
                }
            }
            return true;
        }

        const fullNameInput = document.getElementById('full_name');
        const nameCounter = document.getElementById('name-counter');

        fullNameInput.addEventListener('input', function() {
            const length = this.value.length;
            nameCounter.textContent = `${length}/9 characters`;
            nameCounter.style.color = length >= 9 ? '#a8e063' : 'rgba(255,255,255,0.7)';
            if (length >= 9) {
                nameCounter.style.fontWeight = '600';
                createSparkle(this);
            }
        });

        const emailInput = document.getElementById('email');
        const emailValidation = document.getElementById('email-validation');

        emailInput.addEventListener('blur', function() {
            const email = this.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email && emailRegex.test(email)) {
                emailValidation.style.display = 'block';
                emailValidation.style.color = '#a8e063';
                emailValidation.textContent = '‚úì Valid email address';
            } else if (email) {
                emailValidation.style.display = 'block';
                emailValidation.style.color = '#ff4b2b';
                emailValidation.textContent = '‚úó Invalid email format';
            }
        });

        function previewLogo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logo-preview');
                    const img = document.getElementById('logo-preview-img');
                    img.src = e.target.result;
                    preview.style.display = 'block';
                    createSparkle(preview);
                };
                reader.readAsDataURL(file);
            }
        }

        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const button = event.target.closest('.toggle-btn');
            const icon = button.querySelector('.eye-icon');
            
            button.classList.add('toggled');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.textContent = 'üôà';
                createParticles(button);
            } else {
                field.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
            
            setTimeout(() => button.classList.remove('toggled'), 400);
        }

        const passwordInput = document.getElementById('password');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');

        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                case: /[a-z]/.test(password) && /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^a-zA-Z0-9]/.test(password)
            };

            updateRequirement('req-length', requirements.length);
            updateRequirement('req-case', requirements.case);
            updateRequirement('req-number', requirements.number);
            updateRequirement('req-special', requirements.special);

            Object.values(requirements).forEach(met => {
                if (met) strength++;
            });

            strengthBar.className = 'password-strength-bar';
            if (strength <= 1) {
                strengthBar.classList.add('strength-weak');
                strengthText.textContent = 'üí™ Weak password';
                strengthText.style.color = '#ff4b2b';
            } else if (strength <= 3) {
                strengthBar.classList.add('strength-medium');
                strengthText.textContent = 'üëç Medium password';
                strengthText.style.color = '#f09819';
            } else {
                strengthBar.classList.add('strength-strong');
                strengthText.textContent = 'üî• Strong password!';
                strengthText.style.color = '#a8e063';
                if (strength === 4) createSparkle(passwordInput);
            }
        });

        function updateRequirement(id, met) {
            const req = document.getElementById(id);
            if (met) {
                req.classList.add('met');
            } else {
                req.classList.remove('met');
            }
        }

        const confirmPasswordInput = document.getElementById('confirm_password');
        const passwordMatch = document.getElementById('password-match');

        confirmPasswordInput.addEventListener('input', function() {
            const password = passwordInput.value;
            const confirmPassword = this.value;

            if (confirmPassword) {
                if (password === confirmPassword) {
                    passwordMatch.textContent = '‚úì Passwords match!';
                    passwordMatch.style.color = '#a8e063';
                    createSparkle(this);
                } else {
                    passwordMatch.textContent = '‚úó Passwords do not match';
                    passwordMatch.style.color = '#ff4b2b';
                }
            } else {
                passwordMatch.textContent = '';
            }
        });

        function connectGoogle() {
            window.location.href = '{{ url_for("google_login") }}';
        }

        const registerForm = document.getElementById('registerForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = submitBtn.querySelector('.btn-text');
        const btnLoading = submitBtn.querySelector('.btn-loading');

        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (password !== confirmPassword) {
                showAlert('‚ùå Passwords do not match', 'error');
                return;
            }

            if (fullNameInput.value.length < 9) {
                showAlert('‚ùå Full name must be at least 9 characters', 'error');
                return;
            }

            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-flex';
            btnLoading.style.alignItems = 'center';
            btnLoading.style.justifyContent = 'center';
            btnLoading.style.gap = '10px';

            const formData = new FormData(this);

            // Get CSRF token
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
            const headers = {};
            if (csrfToken) {
                headers['X-CSRFToken'] = csrfToken;
            }
            
            try {
                const response = await fetch('{{ url_for("register") }}', {
                    method: 'POST',
                    body: formData,
                    headers: headers
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                    submitBtn.style.background = 'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)';
                    createSuccessExplosion();
                    setTimeout(() => {
                        window.location.href = '{{ url_for("login") }}';
                    }, 2000);
                } else {
                    showAlert('‚ùå ' + data.message, 'error');
                    submitBtn.disabled = false;
                    btnText.style.display = 'inline';
                    btnLoading.style.display = 'none';
                }
            } catch (error) {
                showAlert('‚ùå An error occurred. Please try again.', 'error');
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        });

        function createParticles(element) {
            const rect = element.getBoundingClientRect();
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe'];

            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `position: fixed; left: ${rect.left + rect.width / 2}px; top: ${rect.top + rect.height / 2}px; width: 6px; height: 6px; border-radius: 50%; background: ${colors[Math.floor(Math.random() * colors.length)]}; pointer-events: none; z-index: 9999; box-shadow: 0 0 10px currentColor;`;
                document.body.appendChild(particle);

                const angle = (Math.PI * 2 * i) / 8;
                const velocity = 50;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 600,
                    easing: 'cubic-bezier(0, 0.9, 0.3, 1)'
                }).onfinish = () => particle.remove();
            }
        }

        function createSparkle(element) {
            const rect = element.getBoundingClientRect();
            const sparkle = document.createElement('div');
            sparkle.innerHTML = '‚ú®';
            sparkle.style.cssText = `position: fixed; left: ${rect.right - 30}px; top: ${rect.top - 10}px; font-size: 20px; pointer-events: none; z-index: 9999;`;
            document.body.appendChild(sparkle);

            sparkle.animate([
                { opacity: 0, transform: 'translateY(0) scale(0.5)' },
                { opacity: 1, transform: 'translateY(-20px) scale(1)' },
                { opacity: 0, transform: 'translateY(-40px) scale(1.2)' }
            ], {
                duration: 1000,
                easing: 'ease-out'
            }).onfinish = () => sparkle.remove();
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `position: fixed; left: ${Math.random() * 100}%; top: -10px; width: 10px; height: 10px; background: ${colors[Math.floor(Math.random() * colors.length)]}; pointer-events: none; z-index: 9999; border-radius: ${Math.random() > 0.5 ? '50%' : '0'};`;
                    document.body.appendChild(confetti);

                    const tx = (Math.random() - 0.5) * 200;
                    const rotation = Math.random() * 720;

                    confetti.animate([
                        { transform: 'translateY(0) translateX(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) translateX(${tx}px) rotate(${rotation}deg)`, opacity: 0 }
                    ], {
                        duration: 2000 + Math.random() * 1000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    }).onfinish = () => confetti.remove();
                }, i * 30);
            }
        }

        function createSuccessExplosion() {
            const colors = ['#56ab2f', '#a8e063', '#00f2fe', '#4facfe'];
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `position: fixed; left: 50%; top: 50%; width: 8px; height: 8px; background: ${colors[Math.floor(Math.random() * colors.length)]}; border-radius: 50%; pointer-events: none; z-index: 9999; box-shadow: 0 0 15px currentColor;`;
                document.body.appendChild(particle);

                const angle = (Math.PI * 2 * i) / 50;
                const velocity = 100 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.animate([
                    { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
                    { transform: `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(0)`, opacity: 0 }
                ], {
                    duration: 1000 + Math.random() * 500,
                    easing: 'cubic-bezier(0, 0.9, 0.3, 1)'
                }).onfinish = () => particle.remove();
            }
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass}`;
            alertDiv.innerHTML = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);
            setTimeout(() => {
                alertDiv.style.animation = 'slideOutUp 0.4s ease-out forwards';
                setTimeout(() => alertDiv.remove(), 400);
            }, 5000);
        }

        {% if google_email %}
        document.getElementById('google-connect-btn').style.display = 'none';
        document.getElementById('or-divider').style.display = 'none';
        const connectedStatus = document.getElementById('google-connected-status');
        const connectedEmail = document.getElementById('connected-email');
        connectedStatus.style.display = 'block';
        connectedEmail.textContent = '{{ google_email }}';
        document.getElementById('password').removeAttribute('required');
        document.getElementById('confirm_password').removeAttribute('required');
        document.getElementById('password').placeholder = 'Optional (Google signup will auto-generate)';
        document.getElementById('confirm_password').placeholder = 'Optional';
        setTimeout(() => createSparkle(connectedStatus), 300);
        {% endif %}

        const allInputs = document.querySelectorAll('input, select, textarea');
        allInputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.02)';
                this.parentElement.style.transition = 'transform 0.3s ease';
            });
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        });

        let lastTrailTime = 0;
        const colorPalette = ['#40e0d0', '#4facfe', '#00f2fe', '#56ab2f', '#a8e063', '#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#667eea', '#764ba2'];
        let lastX = 0;
        let lastY = 0;
        
        document.addEventListener('mousemove', function(e) {
            const now = Date.now();
            if (now - lastTrailTime > 30) {
                lastTrailTime = now;
                
                // Create sketchy brush strokes
                for (let i = 0; i < 2; i++) {
                    const sketch = document.createElement('div');
                    const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                    const size = 3 + Math.random() * 4;
                    const offsetX = (Math.random() - 0.5) * 15;
                    const offsetY = (Math.random() - 0.5) * 15;
                    const rotation = Math.random() * 180;
                    const roughness = 0.3 + Math.random() * 0.4;
                    
                    // Calculate distance from last position for sketchy effect
                    const distance = Math.sqrt(Math.pow(e.clientX - lastX, 2) + Math.pow(e.clientY - lastY, 2));
                    const angle = Math.atan2(e.clientY - lastY, e.clientX - lastX) * (180 / Math.PI);
                    
                    // Create sketchy brush stroke
                    sketch.style.cssText = `
                        position: fixed; 
                        left: ${e.clientX + offsetX}px; 
                        top: ${e.clientY + offsetY}px; 
                        width: ${size}px; 
                        height: ${size * (0.5 + Math.random() * 0.5)}px; 
                        background: ${color}; 
                        border-radius: 50% 30% 50% 30%;
                        box-shadow: 0 0 8px ${color}, 0 0 15px ${color};
                        pointer-events: none; 
                        z-index: 100;
                        transform: rotate(${angle + (Math.random() - 0.5) * 30}deg) scale(${roughness});
                        opacity: 0.7;
                    `;
                    document.body.appendChild(sketch);
                    
                    const finalX = (Math.random() - 0.5) * 80;
                    const finalY = (Math.random() - 0.5) * 80;
                    const finalRotation = rotation + (Math.random() - 0.5) * 90;
                    const nextColor = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                    
                    sketch.animate([
                        { 
                            opacity: 0.8, 
                            transform: `translate(0, 0) rotate(${angle + (Math.random() - 0.5) * 30}deg) scale(${roughness})`,
                            background: color,
                            boxShadow: `0 0 8px ${color}, 0 0 15px ${color}`
                        },
                        { 
                            opacity: 0.6, 
                            transform: `translate(${finalX * 0.6}px, ${finalY * 0.6}px) rotate(${finalRotation * 0.5}deg) scale(${roughness * 0.8})`,
                            background: nextColor,
                            boxShadow: `0 0 12px ${nextColor}, 0 0 25px ${nextColor}`
                        },
                        { 
                            opacity: 0, 
                            transform: `translate(${finalX}px, ${finalY}px) rotate(${finalRotation}deg) scale(0)`,
                            background: nextColor,
                            boxShadow: `0 0 3px ${nextColor}, 0 0 6px ${nextColor}`
                        }
                    ], {
                        duration: 1800,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    }).onfinish = () => sketch.remove();
                }
                
                lastX = e.clientX;
                lastY = e.clientY;
            }
        });

        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-3px)';
            });
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
</body>
</html>