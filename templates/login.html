
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Login - Learning Platform</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loginglass.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-theme">
    <!-- Animated Background Elements -->
    <div class="animated-bg">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="particle-container" id="particles"></div>
    </div>

    <!-- Professional Navigation -->
    <nav class="navbar-glass">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{{ url_for('index') }}" class="nav-link-btn">
                    <i class="fas fa-home"></i> Home
                </a>
            </div>
            <div class="nav-center">
                <a href="{{ url_for('index') }}" class="logo-main">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Learning Platform</span>
                </a>
            </div>
            <div class="nav-right">
                <a href="{{ url_for('register') }}" class="nav-link-btn">
                    <i class="fas fa-user-plus"></i> Sign Up
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <main class="glass main-content">
            <h1 class="welcome-title">Welcome Back</h1>
            
            <div id="alert-container"></div>

            <!-- Google Login -->
            <div class="google-login-wrapper">
                <a href="{{ url_for('google_login') }}" class="btn btn-google">
                    <i class="fab fa-google"></i>
                    <span>login  with Google</span>
                </a>
                <div class="divider">
                    <span class="divider-line"></span>
                    <span class="divider-text">OR</span>
                    <span class="divider-line"></span>
                </div>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username_or_email">
                        <i class="fas fa-user"></i>
                        Username or Email
                    </label>
                    <input type="text" 
                           id="username_or_email" 
                           name="username_or_email" 
                           required 
                           placeholder="Enter your username or email"
                           autocomplete="username">
                    <div class="input-glow"></div>
                </div>

                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i>
                        Password
                    </label>
                    <div class="password-input-wrapper">
                        <input type="password" 
                               id="password" 
                               name="password" 
                               required 
                               placeholder="Enter your password"
                               autocomplete="current-password">
                        <button type="button" class="toggle-password-btn" id="togglePassword">
                            <i class="fas fa-eye" id="eyeIcon"></i>
                        </button>
                        <div class="input-glow"></div>
                    </div>
                </div>

                <div class="forgot-password-link">
                    <a href="{{ url_for('forgot_password') }}">
                        <i class="fas fa-question-circle"></i>
                        Forgot Password?
                    </a>
                </div>

                <button type="submit" class="btn btn-primary btn-submit" id="submitBtn">
                    <span class="btn-text">
                        <i class="fas fa-sign-in-alt"></i>
                        Login
                    </span>
                    <span class="btn-loading" style="display: none;">
                        <span class="spinner"></span>
                        <span>Logging in...</span>
                    </span>
                </button>
            </form>

            <p class="register-link">
                Don't have an account? 
                <a href="{{ url_for('register') }}">
                    <i class="fas fa-arrow-right"></i>
                    Register here
                </a>
            </p>
        </main>
    </div>

    <script>
        const passwordField = document.getElementById('password');
        const submitBtn = document.getElementById('submitBtn');

        // Password Toggle
        const togglePassword = document.getElementById('togglePassword');
        const eyeIcon = document.getElementById('eyeIcon');
        
        togglePassword.addEventListener('click', function(e) {
            e.preventDefault();
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
                createSparkles(this);
            } else {
                passwordField.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        });

        // Create sparkle effect
        function createSparkles(element) {
            const rect = element.getBoundingClientRect();
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24'];
            
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.position = 'fixed';
                sparkle.style.left = rect.left + rect.width / 2 + 'px';
                sparkle.style.top = rect.top + rect.height / 2 + 'px';
                sparkle.style.width = '4px';
                sparkle.style.height = '4px';
                sparkle.style.borderRadius = '50%';
                sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];
                sparkle.style.pointerEvents = 'none';
                sparkle.style.zIndex = '9999';
                sparkle.style.boxShadow = `0 0 8px ${colors[Math.floor(Math.random() * colors.length)]}`;
                
                document.body.appendChild(sparkle);
                
                const angle = (Math.PI * 2 * i) / 12;
                const velocity = 60 + Math.random() * 40;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                sparkle.animate([
                    { transform: 'translate(0, 0) scale(1) rotate(0deg)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0) rotate(360deg)`, opacity: 0 }
                ], {
                    duration: 800 + Math.random() * 400,
                    easing: 'cubic-bezier(0, 0.9, 0.3, 1)'
                }).onfinish = () => sparkle.remove();
            }
        }

        // Create background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        createParticles();

        // Form submission (KEEPING ALL ORIGINAL FUNCTIONALITY)
        const loginForm = document.getElementById('loginForm');
        const btnText = submitBtn.querySelector('.btn-text');
        const btnLoading = submitBtn.querySelector('.btn-loading');

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-flex';
            btnLoading.style.alignItems = 'center';
            btnLoading.style.gap = '10px';
            
            const formData = new FormData(this);
            
            // Get CSRF token
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
            const headers = {};
            if (csrfToken) {
                headers['X-CSRFToken'] = csrfToken;
            }
            
            try {
                const response = await fetch('{{ url_for("login") }}', {
                    method: 'POST',
                    body: formData,
                    headers: headers
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Login successful! Redirecting...', 'success');
                    
                    submitBtn.style.background = 'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)';
                    createSuccessRipple(submitBtn);
                    
                    setTimeout(() => {
                        window.location.href = data.redirect;
                    }, 1000);
                } else {
                    showAlert(data.message, 'error');
                    
                    loginForm.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        loginForm.style.animation = '';
                    }, 500);
                    
                    submitBtn.disabled = false;
                    btnText.style.display = 'inline';
                    btnLoading.style.display = 'none';
                }
            } catch (error) {
                showAlert('An error occurred. Please try again.', 'error');
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        });

        // Success ripple effect
        function createSuccessRipple(element) {
            const ripple = document.createElement('div');
            const rect = element.getBoundingClientRect();
            
            ripple.style.position = 'fixed';
            ripple.style.left = rect.left + rect.width / 2 + 'px';
            ripple.style.top = rect.top + rect.height / 2 + 'px';
            ripple.style.width = '0';
            ripple.style.height = '0';
            ripple.style.borderRadius = '50%';
            ripple.style.background = 'rgba(168, 224, 99, 0.5)';
            ripple.style.transform = 'translate(-50%, -50%)';
            ripple.style.pointerEvents = 'none';
            ripple.style.zIndex = '9999';
            
            document.body.appendChild(ripple);
            
            ripple.animate([
                { width: '0', height: '0', opacity: 1 },
                { width: '500px', height: '500px', opacity: 0 }
            ], {
                duration: 800,
                easing: 'ease-out'
            }).onfinish = () => ripple.remove();
        }

        // Enhanced alert function
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass}`;
            alertDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'slideOutUp 0.4s ease-out forwards';
                setTimeout(() => {
                    alertDiv.remove();
                }, 400);
            }, 5000);
        }

        // Input focus animations
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
                const glow = this.parentElement.querySelector('.input-glow');
                if (glow) {
                    glow.style.opacity = '1';
                }
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('focused');
                const glow = this.parentElement.querySelector('.input-glow');
                if (glow) {
                    glow.style.opacity = '0';
                }
            });
        });

        // Add animations CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
            
            @keyframes slideOutUp {
                to {
                    opacity: 0;
                    transform: translateY(-30px);
                }
            }

            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-20px) rotate(5deg); }
            }

            @keyframes particleFloat {
                0%, 100% { transform: translateY(0px) translateX(0px); opacity: 0.3; }
                50% { transform: translateY(-100px) translateX(50px); opacity: 0.8; }
            }

            @keyframes sparkle {
                0%, 100% { opacity: 0; transform: scale(0); }
                50% { opacity: 1; transform: scale(1); }
            }

            @keyframes celebrate {
                0%, 100% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.1) rotate(-5deg); }
                75% { transform: scale(1.1) rotate(5deg); }
            }

            .spinner {
                width: 16px;
                height: 16px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-top-color: white;
                border-radius: 50%;
                animation: spin 0.8s linear infinite;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
